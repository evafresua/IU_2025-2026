<!DOCTYPE html>
<html>
<head>
    <title>Test Runner Alumnograduacion</title>
    <script src="../../Core/Validations_Class.js"></script>
    <script src="../../Core/Dom_table_Class.js"></script>
    <script src="../../Core/Dom_Class.js"></script>
    <script src="../../app/alumnograduacion_Class.js"></script>
    <script src="../../app/ET1_alumnograduación_infotest.js"></script>
<body>
    <h1>Test Runner Alumnograduacion</h1>
    <div id="test-results"></div>
    <div id="IU_form" style="display:none"></div>
    <script>
        function setFieldValue(field, value) {
            let el = document.getElementById(field);
            if (el) el.value = value;
        }

        function runTests() {
            if (typeof Validations === 'undefined') {
                document.getElementById('test-results').innerHTML = '<b>Error:</b> Validations class not loaded.';
                return;
            }
            if (typeof dom_table === 'undefined') {
                document.getElementById('test-results').innerHTML = '<b>Error:</b> dom_table class not loaded.';
                return;
            }
            if (typeof alumnograduacion === 'undefined') {
                document.getElementById('test-results').innerHTML = '<b>Error:</b> alumnograduacion class not loaded.';
                return;
            }
            let entidad = new alumnograduacion('alumnograduacion_dni');
            let results = [];
            for (let test of window.alumnograduacion_tests_fields) {
                let [entidadName, field, id, num, op, values, expected] = test;
                let fieldName = Object.keys(values[0])[0];
                let fieldValue = values[0][fieldName];
                setFieldValue(field, fieldValue);
                let methodName = `${op.toUpperCase()}_${field}_validation`;
                let result;
                try {
                    result = entidad[methodName]();
                } catch (e) {
                    result = `Error: ${e}`;
                }
                let passed = (result === true && expected === true) || (result === expected);
                results.push(`<tr><td>${id}</td><td>${field}</td><td>${fieldValue}</td><td>${result}</td><td>${expected}</td><td>${passed ? '✅' : '❌'}</td></tr>`);
            }
            document.getElementById('test-results').innerHTML = `<table border='1'><tr><th>ID</th><th>Campo</th><th>Valor</th><th>Resultado</th><th>Esperado</th><th>Test</th></tr>${results.join('')}</table>`;
        }
        // Los tests se ejecutan automáticamente al cargar la página
        window.onload = function() {
            // Crea inputs ocultos para todos los campos requeridos por los tests
            let fields = [
                'alumnograduacion_login','alumnograduacion_password','alumnograduacion_nombre','alumnograduacion_apellidos',
                'alumnograduacion_titulacion','alumnograduacion_dni','alumnograduacion_telefono','alumnograduacion_direccion',
                'alumnograduacion_email','alumnograduacion_fotoacto'
            ];
            for (let f of fields) {
                let input = document.createElement('input');
                input.type = 'text';
                input.id = f;
                input.style.display = 'none';
                document.body.appendChild(input);
            }
            // Ejecuta los tests automáticamente
            runTests();
        }
    </script>
</body>
</html>